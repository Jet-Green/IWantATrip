import{_ as G,m as J,u as K,Q as O,k as W,C as P,r as D,n as X,b as f,o as i,c as m,d as l,w as a,e as t,H as ee,g as te,h as s,t as c,f as L,q as w,F as S,v as U,x as d,y as I,Y as se,Z as oe}from"./index.0a2bdc2d.js";const x=b=>(se("data-v-dc4be103"),b=b(),oe(),b),le={style:{"overflow-x":"hidden"}},ae={class:"ma-0"},ne=["src"],re=["src"],ue=x(()=>s("div",{class:"custom-slick-arrow",style:{left:"10px","z-index":"1"}},[s("span",{class:"mdi mdi-48px mdi-chevron-left"})],-1)),ie=x(()=>s("div",{class:"custom-slick-arrow",style:{right:"10px"}},[s("span",{class:"mdi mdi-48px mdi-chevron-right"})],-1)),ce=d(" \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C: "),de=d(" \u0411\u043B\u0438\u0436\u0430\u0439\u0448\u0438\u0439 \u0432\u044B\u0435\u0437\u0434: "),_e=x(()=>s("div",null,"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0447\u0435\u043B\u043E\u0432\u0435\u043A:",-1)),pe={style:{width:"50%"}},fe=d(" \u0426\u0435\u043D\u0430 "),me={class:"d-flex justify-center ma-8"},ve=d(" \u041A\u0443\u043F\u0438\u0442\u044C "),he={key:0},ge=["innerHTML"],ye=d(" \u0424a\u043C\u0438\u043B\u0438\u044F \u0418\u043C\u044F "),xe=d(" \u0422\u0435\u043B\u0435\u0444\u043E\u043D "),be=x(()=>s("div",null,"\u0426\u0435\u043D\u0430",-1)),ke={class:"d-flex direction-column"},we=x(()=>s("span",{style:{"font-size":"8px"}},"\u043A\u043E\u043B-\u0432\u043E",-1)),Ie=x(()=>s("div",null,"\u041E\u043F\u043B\u0430\u0442\u0438\u0442\u044C",-1)),Te={class:"d-flex space-around"},Ce=d(" \u0441\u0435\u0439\u0447\u0430\u0441 "),Pe=d(" \u043F\u043E\u0442\u043E\u043C "),De={__name:"TripInfoPage",setup(b){const j=J(),F=K().query._id,z=O(),_=W(),N="/trips",V=P(()=>o.value.creatorForm[1]=="author"?"\u0430\u0432\u0442\u043E\u0440 \u0442\u0443\u0440\u0430":o.value.creatorForm[1]=="operator"?"\u0442\u0443\u0440\u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440":"\u0442\u0443\u0440\u0430\u0433\u0435\u043D\u0441\u0442\u0432\u043E");let g=D([]),o=D({}),v=X({fullname:"",phone:""}),k=P(()=>{let r=0;for(let e=0;e<o.value.billsList.length;e++)for(let u=0;u<o.value.billsList[e].cart.length;u++)r+=o.value.billsList[e].cart[u].count;return r});z.getById(F).then(r=>{o.value=r.data;for(let e of r.data.cost)g.value.push({cost:e.price,count:0,costType:e.first})}).catch(r=>{console.log(r)});const $=r=>{let e=new Date(r).toLocaleDateString("ru-Ru",{year:"2-digit",month:"2-digit",day:"2-digit"});return e!=="Invalid Date"&&e?e:""};function A(r){return o.value.images[r]}let H=P(()=>{let r=0;if(g.value.length)for(let e of g.value)r+=e.cost*e.count;return r}),y=D(!1),q=()=>{_.user?y.value=!0:j.push("/reg")};async function B(r){if(v.phone){let e={isBoughtNow:r,cart:[...g.value],userId:_.user._id};for(let u=0;u<e.cart.length;u++)e.cart[u].count==0&&e.cart.splice(u,1);await _.buyTrip(o.value._id,e).then(()=>{I.config({duration:3,top:"90vh"}),I.success({content:"\u0422\u0443\u0440 \u0437\u0430\u043A\u0430\u0437\u0430\u043D!"}),y.value=!1}).catch(u=>{console.log(u)}),_.user.fullinfo.fullname=v.fullname,_.user.fullinfo.phone=v.phone,await _.updateUser({email:_.user.email,fullinfo:_.user.fullinfo}).then(u=>{_.user=u.data}).catch(u=>{console.log(u)})}else I.config({duration:3,top:"90vh"}),I.success({content:"\u041D\u0443\u0436\u0435\u043D \u0442\u0435\u043B\u0435\u0444\u043E\u043D"})}return(r,e)=>{const u=f("a-spin"),M=f("a-carousel"),p=f("a-col"),E=f("a-progress"),T=f("a-button"),C=f("a-row"),R=f("a-input"),Q=f("a-input-number"),Y=f("a-modal");return i(),m("div",le,[l(te,{backRoute:N}),l(C,{class:"justify-center d-flex"},{default:a(()=>[l(p,{xs:22,xl:16},{default:a(()=>[s("h2",ae,c(t(o).name),1),t(o)._id?w("",!0):(i(),L(u,{key:0,size:"large"})),t(o)._id?(i(),L(C,{key:1,gutter:[12,12],class:"text justify-center d-flex"},{default:a(()=>[l(p,{xs:24,md:12},{default:a(()=>[l(M,{arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:a(n=>[s("a",null,[s("img",{src:A(n.i)},null,8,ne)])]),prevArrow:a(()=>[ue]),nextArrow:a(()=>[ie]),default:a(()=>[(i(!0),m(S,null,U(t(o).images,(n,h)=>(i(),m("div",{key:h},[s("img",{src:n,alt:"",srcset:""},null,8,re)]))),128))]),_:1})]),_:1}),l(p,{xs:24,md:12,class:"pa-8"},{default:a(()=>[s("p",null,"\u0410\u0432\u0442\u043E\u0440 \u0442\u0443\u0440\u0430: "+c(t(o).creatorForm[0])+" ("+c(t(V))+")",1),s("p",null,c(t(o).offer),1),s("div",null,[ce,s("b",null,c(t(o).duration)+" \u0434\u043D.",1)]),s("div",null,[de,s("b",null,c($(t(o).start)),1)]),_e,s("div",pe,[l(E,{percent:t(k)/t(o).maxPeople*100,format:()=>`${t(o).maxPeople} \u0447\u0435\u043B`},null,8,["percent","format"])]),s("div",null,[fe,(i(!0),m(S,null,U(t(o).cost,(n,h)=>(i(),m("div",{key:h,class:"cost"},[d(c(n.first)+" : ",1),s("b",null,c(n.price)+" \u0440\u0443\u0431.",1)]))),128))]),s("div",me,[t(k)!=t(o).maxPeople?(i(),L(T,{key:0,type:"primary",class:"lets_go_btn",size:"large",style:{display:"flex","justify-content":"center"},onClick:e[0]||(e[0]=n=>t(q)())},{default:a(()=>[ve]),_:1})):w("",!0)]),s("div",null,[t(k)==t(o).maxPeople?(i(),m("b",he," \u043C\u0435\u0441\u0442 \u0431\u043E\u043B\u044C\u0448\u0435 \u043D\u0435\u0442 ")):w("",!0)])]),_:1}),l(p,{xs:24},{default:a(()=>[s("span",{innerHTML:t(o).description},null,8,ge)]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1}),l(Y,{visible:t(y),"onUpdate:visible":e[5]||(e[5]=n=>ee(y)?y.value=n:y=n),footer:null},{default:a(()=>[l(C,{gutter:[4,4]},{default:a(()=>[l(p,{span:24,md:12},{default:a(()=>[ye,l(R,{style:{width:"100%"},value:t(v).fullname,"onUpdate:value":e[1]||(e[1]=n=>t(v).fullname=n),placeholder:"\u0418\u0432\u0430\u043D\u043E\u0432 \u0418\u0432\u0430\u043D \u0418\u0432\u0430\u043D\u043E\u0432\u0438\u0447"},null,8,["value"])]),_:1}),l(p,{span:24,md:12},{default:a(()=>[xe,l(R,{style:{width:"100%"},value:t(v).phone,"onUpdate:value":e[2]||(e[2]=n=>t(v).phone=n),placeholder:"79127528874"},null,8,["value"])]),_:1}),l(p,{span:24},{default:a(()=>[be,(i(!0),m(S,null,U(t(o).cost,(n,h)=>(i(),m("div",{class:"d-flex space-around align-center",key:h},[d(c(n.first),1),s("span",null,c(n.price)+" \u0440\u0443\u0431. ",1),s("div",ke,[we,l(Q,{value:t(g)[h].count,"onUpdate:value":Z=>t(g)[h].count=Z,min:0,max:t(o).maxPeople-t(k),placeholder:"\u0447\u0435\u043B"},null,8,["value","onUpdate:value","max"])])]))),128))]),_:1}),l(p,{span:24},{default:a(()=>[s("b",null,"\u0418\u0442\u043E\u0433\u043E: "+c(t(H))+" \u0440\u0443\u0431.",1)]),_:1}),l(p,{span:24},{default:a(()=>[Ie,s("div",Te,[l(T,{type:"primary",onClick:e[3]||(e[3]=n=>B(!0))},{default:a(()=>[Ce]),_:1}),l(T,{onClick:e[4]||(e[4]=n=>B(!1))},{default:a(()=>[Pe]),_:1})])]),_:1})]),_:1})]),_:1},8,["visible"])])}}},Ue=G(De,[["__scopeId","data-v-dc4be103"]]);export{Ue as default};
