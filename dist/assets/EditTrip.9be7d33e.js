import{k as ie,Q as pe,l as me,r as m,R as D,m as ce,I as J,p as fe,b as c,o as V,c as w,d as e,w as l,g as ve,e as o,T as v,h,F,v as $,H as z,t as W,x as r,S as X,y as P,K as _e,f as ge}from"./index.0a2bdc2d.js";import{_ as he}from"./ImageCropper.f99bd2c4.js";import{c as Y,a as C,F as ye,b as _,E as g}from"./vee-validate.esm.5a513712.js";import{Q as xe}from"./vue-quill.snow.0b030aed.js";import{l as be}from"./ru_RU.4069901f.js";const Ue=h("h2",null,"\u0421\u043E\u0437\u0434\u0430\u0442\u044C \u0442\u0443\u0440",-1),Se=r(" \u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 "),Ve=r(" \u0424\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 "),Ne={class:"d-flex",style:{"overflow-x":"scroll"}},Te=["src","onClick"],ke=h("span",{class:"mdi mdi-12px mdi-plus"},null,-1),we=r(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0444\u043E\u0442\u043E "),Ce=r(" \u0414\u0430\u0442\u0430 \u043D\u0430\u0447\u0430\u043B\u0430 "),qe=r(" \u0414\u0430\u0442\u0430 \u043A\u043E\u043D\u0446\u0430 "),De=r(" \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C "),Le={style:{"line-height":"40px"}},Me=r(" \u041C\u0430\u043A\u0441. \u0447\u0438\u0441\u043B\u043E \u043B\u044E\u0434\u0435\u0439 "),Oe=r(" \u0426\u0435\u043D\u044B "),Re=h("span",{class:"mdi mdi-minus",style:{cursor:"pointer"}},null,-1),Ae=h("span",{class:"mdi mdi-12px mdi-plus"},null,-1),Je=r(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0446\u0435\u043D\u044B "),Pe=r(" \u0422\u0438\u043F \u0442\u0443\u0440\u0430 "),je=r(" \u041C\u0438\u043D. \u0432\u043E\u0437\u0440\u0430\u0441\u0442, \u043B\u0435\u0442 "),Fe=r(" \u041C\u0435\u0441\u0442\u043E \u0441\u0442\u0430\u0440\u0442\u0430 "),$e=r(" \u0420\u0435\u043A\u043B\u0430\u043C\u0430 "),ze=r(" \u041C\u0430\u0440\u0448\u0440\u0443\u0442 "),Ye=r(" \u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B "),Be=r("\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C "),Ee=h("h3",null,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E?",-1),Ie={class:"d-flex justify-center"},Qe=r("\u0414\u0430 "),ea={__name:"EditTrip",setup(He){ie();const Z=pe(),ee=me(),B=["DD.MM.YYYY","DD.MM.YY"],E=be,L=m(null);let I="";const S=m(null),y=m(null),x=m(null);m(null);const M=m(!1),O=m(null);D(1679492631e3),D(1679492631e3),D(1679492631e3);const Q=ce();let R=m([]),N=m(""),b=m(!1),A=m([]),q=[],s=m({name:"",start:null,end:null,maxPeople:null,duration:"",images:[],tripRoute:"",distance:"",cost:[],offer:"",description:S.value,tripType:"",fromAge:"",startLocation:null});const ae=n=>{let t=s.value.cost.indexOf(n);t!==-1&&s.value.cost.splice(t,1)},te=()=>{s.value.cost.push({type:"",price:""})},le=()=>{A.value.splice(O.value,1),q.splice(O.value,1),s.value.images.splice(O.value,1),M.value=!1};function oe(){S.value=S.value.split("<p><br></p>").join(""),s.value.description=S.value,s.value.isModerated=!1,X.updateTrip(s.value).then(n=>{const t=n.data._id;let f=new FormData;for(let i=0;i<q.length;i++){let U=i+s.value.images.length;f.append("trip-image",q[i],t+"_"+U+".img")}function d(){Q.push("/cabinet/me")}q.length?X.uploadTripImages(f).then(i=>{P.config({duration:3,top:"90vh"}),P.success({content:"\u0422\u0443\u0440 \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D!",onClose:d})}):(P.config({duration:3,top:"90vh"}),P.success({content:"\u0422\u0443\u0440 \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D!",onClose:d}))})}function se(n){b.value=!1,q.push(n),A.value.push(URL.createObjectURL(n))}function ne(n){for(let t of R.value)t.value==n&&(s.value.startLocation=t.geo)}J(N,async(n,t)=>{if(n.trim().length>2&&n.length>t.length){var f="https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",d={method:"POST",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token 93a66149524b08b26a740de84a773157ace019a0"},body:JSON.stringify({query:n,count:5,from_bound:{value:"city"},to_bound:{value:"settlement"}})};let i=await fetch(f,d);try{let U=JSON.parse(await i.text()).suggestions;R.value=[];for(let p of U){let T={value:p.value,geo:{name:p.value,shortName:"",geo_lat:p.data.geo_lat,geo_lon:p.data.geo_lon}};p.data.settlement?T.geo.shortName=p.data.settlement:p.data.city?T.geo.shortName=p.data.city:T.geo.shortName=p.value,R.value.push(T)}}catch(U){console.log(U)}}}),fe(()=>{Z.getById(Q.currentRoute.value.query._id).then(n=>{let t=n.data;delete t.__v,y.value=D(new Date(t.start)),x.value=D(new Date(t.end)),N.value=t.startLocation.name,s.value=t;for(let f of s.value.images)A.value.push(f);L.value.setHTML(t.description)})}),J(S,n=>{I=n,I!==n&&(L.value.setHTML(n),_e(()=>{let t=L.value.getQuill();t.setSelection(n.length,0,"api"),t.focus()}))}),J(y,()=>{let n=Number(JSON.parse(JSON.stringify(x.value)))-Number(JSON.parse(JSON.stringify(y.value)));n>=0?s.value.duration=Math.round(n/864e5):s.value.duration="",y.value&&(s.value.start=Number(Date.parse(y.value.$d.toString())))}),J(x,()=>{let n=Date.parse(JSON.parse(JSON.stringify(x.value)))-Date.parse(JSON.parse(JSON.stringify(y.value)));s.value.duration=Math.round(n/864e5),n>=0?s.value.duration=Math.round(n/864e5):s.value.duration="",x.value&&(s.value.end=Number(Date.parse(x.value.$d.toString())))});let ue=Y({name:C().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),start:Y().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),end:Y().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),maxPeople:C().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),tripType:C().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),fromAge:C().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),offer:C().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435"),tripRoute:C().required("\u0437\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043F\u043E\u043B\u0435")});return(n,t)=>{const f=c("a-input"),d=c("a-col"),i=c("a-button"),U=c("a-date-picker"),p=c("a-input-number"),T=c("a-select-option"),de=c("a-select"),re=c("a-auto-complete"),H=c("a-textarea"),K=c("a-row"),G=c("a-modal");return V(),w("div",null,[e(ve),e(K,{type:"flex",justify:"center"},{default:l(()=>[e(d,{xs:22,lg:12},{default:l(()=>[e(o(ye),{"validation-schema":o(ue),onSubmit:oe},{default:l(({meta:k})=>[e(K,{gutter:[16,16]},{default:l(()=>[e(d,{span:24},{default:l(()=>[Ue,e(o(_),{name:"name",modelValue:o(s).name,"onUpdate:modelValue":t[0]||(t[0]=a=>o(s).name=a)},{default:l(({value:a,handleChange:u})=>[Se,e(f,{placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0443\u0440\u0430",size:"large","onUpdate:value":u,value:a},null,8,["onUpdate:value","value"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"name",class:"error-message"})]),_:1})]),_:1}),e(d,{xs:24},{default:l(()=>[Ve,h("div",Ne,[(V(!0),w(F,null,$(o(A),(a,u)=>(V(),w("img",{key:u,src:a,alt:"",class:"ma-4",style:{"max-width":"200px"},onClick:j=>{M.value=!0,O.value=u}},null,8,Te))),128))]),e(i,{type:"dashed",block:"",onClick:t[1]||(t[1]=a=>z(b)?b.value=!0:b=!0),class:"ma-8"},{default:l(()=>[ke,we]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(o(_),{name:"start",modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=a=>y.value=a)},{default:l(({value:a,handleChange:u})=>[Ce,e(U,{"onUpdate:value":u,value:a,style:{width:"100%"},placeholder:"\u041D\u0430\u0447\u0430\u043B\u043E",locale:o(E),format:B},null,8,["onUpdate:value","value","locale"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"start",class:"error-message"})]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(o(_),{name:"end",modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=a=>x.value=a)},{default:l(({value:a,handleChange:u})=>[qe,e(U,{"onUpdate:value":u,value:a,style:{width:"100%"},placeholder:"\u041A\u043E\u043D\u0435\u0446",locale:o(E),format:B},null,8,["onUpdate:value","value","locale"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"end",class:"error-message"})]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[De,h("p",Le,W(o(s).duration)+" \u0434\u043D.",1)]),_:1}),e(d,{span:12},{default:l(()=>[e(o(_),{name:"maxPeople",modelValue:o(s).maxPeople,"onUpdate:modelValue":t[4]||(t[4]=a=>o(s).maxPeople=a)},{default:l(({value:a,handleChange:u})=>[Me,e(p,{"onUpdate:value":u,value:a,style:{width:"100%"},placeholder:"11",min:1},null,8,["onUpdate:value","value"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"maxPeople",class:"error-message"})]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[Oe,(V(!0),w(F,null,$(o(s).cost,a=>(V(),w("div",{key:a.type,style:{display:"flex"},align:"baseline",class:"mb-16"},[e(f,{value:a.first,"onUpdate:value":u=>a.first=u,placeholder:"\u0414\u043B\u044F \u043A\u043E\u0433\u043E"},null,8,["value","onUpdate:value"]),e(p,{value:a.price,"onUpdate:value":u=>a.price=u,style:{width:"100%"},placeholder:"\u0426\u0435\u043D\u0430",min:0,step:.01,class:"ml-16 mr-16"},null,8,["value","onUpdate:value","step"]),e(i,{onClick:u=>ae(a),shape:"circle"},{default:l(()=>[Re]),_:2},1032,["onClick"])]))),128)),e(i,{type:"dashed",block:"",onClick:te,class:"ma-8"},{default:l(()=>[Ae,Je]),_:1})]),_:1}),e(d,{xs:24,md:12},{default:l(()=>[e(o(_),{name:"tripType",modelValue:o(s).tripType,"onUpdate:modelValue":t[5]||(t[5]=a=>o(s).tripType=a)},{default:l(({value:a,handleChange:u})=>[Pe,h("div",null,[e(de,{"onUpdate:value":u,value:a,style:{width:"100%"}},{default:l(()=>[(V(!0),w(F,null,$(o(ee).appState[0].tripType,j=>(V(),ge(T,{value:j},{default:l(()=>[r(W(j),1)]),_:2},1032,["value"]))),256))]),_:2},1032,["onUpdate:value","value"])])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"tripType",class:"error-message"})]),_:1})]),_:1}),e(d,{xs:24,md:12},{default:l(()=>[e(o(_),{name:"fromAge",modelValue:o(s).fromAge,"onUpdate:modelValue":t[6]||(t[6]=a=>o(s).fromAge=a)},{default:l(({value:a,handleChange:u})=>[je,e(p,{"onUpdate:value":u,value:a,style:{width:"100%"},placeholder:"10",min:0,max:100},null,8,["onUpdate:value","value"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"fromAge",class:"error-message"})]),_:1})]),_:1}),e(d,{xs:24},{default:l(()=>[e(o(_),{name:"startLocation",modelValue:o(N),"onUpdate:modelValue":t[7]||(t[7]=a=>z(N)?N.value=a:N=a)},{default:l(({value:a,handleChange:u})=>[Fe,e(re,{value:a,"onUpdate:value":u,style:{width:"100%"},options:o(R),placeholder:"\u0413\u043B\u0430\u0437\u043E\u0432",onSelect:ne},null,8,["value","onUpdate:value","options"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"location",class:"error-message"})]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(o(_),{name:"offer",modelValue:o(s).offer,"onUpdate:modelValue":t[8]||(t[8]=a=>o(s).offer=a)},{default:l(({value:a,handleChange:u})=>[$e,e(H,{"onUpdate:value":u,value:a,placeholder:"\u0437\u0430\u0432\u043B\u0435\u043A\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",size:"large"},null,8,["onUpdate:value","value"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"offer",class:"error-message"})]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(o(_),{name:"tripRoute",modelValue:o(s).tripRoute,"onUpdate:modelValue":t[9]||(t[9]=a=>o(s).tripRoute=a)},{default:l(({value:a,handleChange:u})=>[ze,e(H,{"onUpdate:value":u,value:a,placeholder:"\u0413\u043B\u0430\u0437\u043E\u0432-\u041F\u0435\u0440\u043C\u044C 300\u043A\u043C",size:"large"},null,8,["onUpdate:value","value"])]),_:1},8,["modelValue"]),e(v,{name:"fade"},{default:l(()=>[e(o(g),{name:"tripRoute",class:"error-message"})]),_:1})]),_:1}),e(d,{span:24,style:{display:"flex","flex-direction":"column"}},{default:l(()=>[Ye,e(o(xe),{theme:"snow",ref_key:"quill",ref:L,content:S.value,"onUpdate:content":t[10]||(t[10]=a=>S.value=a),contentType:"html",toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{color:["#000000","#ff6600","#3daff5"]}],[{align:[]}]]},null,8,["content"])]),_:1}),e(d,{span:24,class:"d-flex justify-center"},{default:l(()=>[e(i,{disabled:!k.valid,class:"lets_go_btn mt-8",type:"primary",size:"large","html-type":"submit"},{default:l(()=>[Be]),_:2},1032,["disabled"])]),_:2},1024)]),_:2},1024)]),_:1},8,["validation-schema"]),e(G,{visible:o(b),"onUpdate:visible":t[11]||(t[11]=k=>z(b)?b.value=k:b=k),footer:null},{default:l(()=>[e(he,{onAddImage:se})]),_:1},8,["visible"]),e(G,{visible:M.value,"onUpdate:visible":t[12]||(t[12]=k=>M.value=k),footer:null},{default:l(()=>[Ee,h("div",Ie,[e(i,{class:"mt-16",type:"primary",size:"large",onClick:le},{default:l(()=>[Qe]),_:1})])]),_:1},8,["visible"])]),_:1})]),_:1})])}}};export{ea as default};
