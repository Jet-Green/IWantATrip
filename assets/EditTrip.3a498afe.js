import{h as V,O as W,r as p,p as X,C as Z,Q as O,m as D,b as c,o as b,c as k,d as t,w as o,B as ee,g as d,e as s,F as z,q as F,s as q,t as te,j as le,l as i,T as A,v as T,x as ae}from"./index.b2427561.js";import{_ as oe}from"./ImageCropper.308ff051.js";import{Q as se}from"./vue-quill.snow.bba8725b.js";import{l as ne}from"./ru_RU.2a46c14e.js";import{t as ue}from"./tripType.8920e512.js";const ie=["onSubmit"],re=d("h2",null,"\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C \u0442\u0443\u0440",-1),de=i(" \u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 "),pe=i(" \u0424\u043E\u0442\u043E\u0433\u0440\u0430\u0444\u0438\u0438 "),ce={class:"d-flex",style:{"overflow-x":"scroll"}},ve=["src","onClick"],_e=d("span",{class:"mdi mdi-12px mdi-plus"},null,-1),fe=i(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0444\u043E\u0442\u043E "),me=i(" \u0414\u0430\u0442\u0430 \u043D\u0430\u0447\u0430\u043B\u0430 "),he=i(" \u0414\u0430\u0442\u0430 \u043A\u043E\u043D\u0446\u0430 "),ge=i(" \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u0435\u043B\u044C\u043D\u043E\u0441\u0442\u044C "),ye={style:{"line-height":"40px"}},xe=i(" \u041C\u0430\u043A\u0441. \u0447\u0438\u0441\u043B\u043E \u043B\u044E\u0434\u0435\u0439 "),be=i(" \u0426\u0435\u043D\u044B "),ke=d("span",{class:"mdi mdi-minus",style:{cursor:"pointer"}},null,-1),Ue=d("span",{class:"mdi mdi-12px mdi-plus"},null,-1),we=i(" \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0446\u0435\u043D\u044B "),Se=i("\u0422\u0438\u043F \u0442\u0443\u0440\u0430 "),Ce=i("\u041C\u0438\u043D. \u0432\u043E\u0437\u0440\u0430\u0441\u0442, \u043B\u0435\u0442 "),Te=i("\u041D\u0430\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 "),Me=i("\u041F\u0435\u0440\u0438\u043E\u0434 "),Ne=i(" \u0420\u0435\u043A\u043B\u0430\u043C\u0430 "),Oe=i(" \u041C\u0430\u0440\u0448\u0440\u0443\u0442 "),De=i(" \u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043F\u0440\u043E\u0433\u0440\u0430\u043C\u043C\u044B "),Je=i("\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C "),Le=d("h3",null,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0444\u043E\u0442\u043E?",-1),Re={class:"d-flex justify-center"},Ye=i("\u0414\u0430 "),$e={__name:"EditTrip",setup(je){V();const $=W(),J=["DD.MM.YYYY","DD.MM.YY"],L=["MM.YY"],M=ne,U=p(null);let R="";const f=p(null),m=p(null),h=p(null),w=p(!1),S=p(null),Y=X();let v=p(!1),C=p([]),y=[],a=p({name:"",start:null,end:null,maxPeople:null,duration:"",images:[],tripRoute:"",distance:"",cost:[],offer:"",description:f.value,location:"",tripType:"",fromAge:"",period:""});const I=n=>{let e=a.value.cost.indexOf(n);e!==-1&&a.value.cost.splice(e,1)},Q=()=>{a.value.cost.push({type:"",price:""})},E=()=>{C.value.splice(S.value,1),y.splice(S.value,1),a.value.images.splice(S.value,1),w.value=!1};function H(){f.value=f.value.split("<p><br></p>").join(""),a.value.description=f.value,A.updateTrip(a.value).then(n=>{const e=n.data._id;let _=new FormData;for(let r=0;r<y.length;r++){let x=r+a.value.images.length;_.append("trip-image",y[r],e+"_"+x+".png")}function u(){Y.push("/cabinet")}y.length?A.uploadTripImages(_).then(r=>{T.config({duration:3,top:"90vh"}),T.success({content:"\u0422\u0443\u0440 \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D!",onClose:u})}):(T.config({duration:3,top:"90vh"}),T.success({content:"\u0422\u0443\u0440 \u043E\u0431\u043D\u043E\u0432\u043B\u0451\u043D!",onClose:u}))})}function G(n){v.value=!1,y.push(n),C.value.push(URL.createObjectURL(n))}return Z(()=>{$.getById(Y.currentRoute.value.query._id).then(n=>{let e=n.data;delete e.__v,e.period=O(e.period,L),m.value=O(e.start),h.value=O(e.end),a.value=e;for(let _ of a.value.images)C.value.push(_);U.value.setHTML(e.description),console.log(a.value)})}),D(f,n=>{R=n,R!==n&&(U.value.setHTML(n),ae(()=>{let e=U.value.getQuill();e.setSelection(n.length,0,"api"),e.focus()}))}),D(m,()=>{let n=Number(JSON.parse(JSON.stringify(h.value)))-Number(JSON.parse(JSON.stringify(m.value)));n>=0?a.value.duration=Math.round(n/864e5):a.value.duration="",a.value.start=m.value.$d.toString()}),D(h,()=>{let n=Date.parse(JSON.parse(JSON.stringify(h.value)))-Date.parse(JSON.parse(JSON.stringify(m.value)));a.value.duration=Math.round(n/864e5),n>=0?a.value.duration=Math.round(n/864e5):a.value.duration="",a.value.end=h.value.$d.toString()}),(n,e)=>{const _=c("a-input"),u=c("a-col"),r=c("a-button"),x=c("a-date-picker"),N=c("a-input-number"),K=c("a-select"),j=c("a-textarea"),B=c("a-row"),P=c("a-modal");return b(),k("div",null,[t(ee),t(B,{type:"flex",justify:"center"},{default:o(()=>[t(u,{xs:22,lg:12},{default:o(()=>[d("form",{action:"POST",onSubmit:le(H,["prevent"])},[t(B,{gutter:[16,16]},{default:o(()=>[t(u,{span:24},{default:o(()=>[re,de,t(_,{placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0442\u0443\u0440\u0430",size:"large",value:s(a).name,"onUpdate:value":e[0]||(e[0]=l=>s(a).name=l)},null,8,["value"])]),_:1}),t(u,{xs:24},{default:o(()=>[pe,d("div",ce,[(b(!0),k(z,null,F(s(C),(l,g)=>(b(),k("img",{key:g,src:l,alt:"",class:"ma-4",style:{"max-width":"200px"},onClick:Be=>{w.value=!0,S.value=g}},null,8,ve))),128))]),t(r,{type:"dashed",block:"",onClick:e[1]||(e[1]=l=>q(v)?v.value=!0:v=!0),class:"ma-8"},{default:o(()=>[_e,fe]),_:1})]),_:1}),t(u,{span:12},{default:o(()=>[me,t(x,{value:m.value,"onUpdate:value":e[2]||(e[2]=l=>m.value=l),style:{width:"100%"},placeholder:"\u041D\u0430\u0447\u0430\u043B\u043E",locale:s(M),format:J},null,8,["value","locale"])]),_:1}),t(u,{span:12},{default:o(()=>[he,t(x,{value:h.value,"onUpdate:value":e[3]||(e[3]=l=>h.value=l),style:{width:"100%"},placeholder:"\u041A\u043E\u043D\u0435\u0446",locale:s(M),format:J},null,8,["value","locale"])]),_:1}),t(u,{span:12},{default:o(()=>[ge,d("p",ye,te(s(a).duration)+" \u0434\u043D.",1)]),_:1}),t(u,{span:12},{default:o(()=>[xe,t(N,{value:s(a).maxPeople,"onUpdate:value":e[4]||(e[4]=l=>s(a).maxPeople=l),style:{width:"100%"},min:1},null,8,["value"])]),_:1}),t(u,{span:24},{default:o(()=>[be,(b(!0),k(z,null,F(s(a).cost,l=>(b(),k("div",{key:l.type,style:{display:"flex"},align:"baseline",class:"mb-16"},[t(_,{value:l.first,"onUpdate:value":g=>l.first=g,placeholder:"\u0414\u043B\u044F \u043A\u043E\u0433\u043E"},null,8,["value","onUpdate:value"]),t(N,{value:l.price,"onUpdate:value":g=>l.price=g,style:{width:"100%"},placeholder:"\u0426\u0435\u043D\u0430",min:0,step:.01,class:"ml-16 mr-16"},null,8,["value","onUpdate:value","step"]),t(r,{onClick:g=>I(l),shape:"circle"},{default:o(()=>[ke]),_:2},1032,["onClick"])]))),128)),t(r,{type:"dashed",block:"",onClick:Q,class:"ma-8"},{default:o(()=>[Ue,we]),_:1})]),_:1}),t(u,{xs:24,md:12},{default:o(()=>[Se,d("div",null,[t(K,{value:s(a).tripType,"onUpdate:value":e[5]||(e[5]=l=>s(a).tripType=l),style:{width:"100%"},options:s(ue)},null,8,["value","options"])])]),_:1}),t(u,{xs:24,md:12},{default:o(()=>[Ce,t(N,{value:s(a).fromAge,"onUpdate:value":e[6]||(e[6]=l=>s(a).fromAge=l),style:{width:"100%"},placeholder:"10",min:0,max:100},null,8,["value"])]),_:1}),t(u,{xs:24,md:12},{default:o(()=>[Te,t(_,{placeholder:"\u0411\u0430\u0439\u043A\u0430\u043B",size:"large",value:s(a).location,"onUpdate:value":e[7]||(e[7]=l=>s(a).location=l)},null,8,["value"])]),_:1}),t(u,{xs:24,md:12},{default:o(()=>[Me,t(x,{value:s(a).period,"onUpdate:value":e[8]||(e[8]=l=>s(a).period=l),style:{width:"100%",height:"40px"},picker:"month",locale:s(M),format:L},null,8,["value","locale"])]),_:1}),t(u,{span:24},{default:o(()=>[Ne,t(j,{placeholder:"\u0437\u0430\u0432\u043B\u0435\u043A\u0430\u0442\u0435\u043B\u044C\u043D\u043E\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435",size:"large",value:s(a).offer,"onUpdate:value":e[9]||(e[9]=l=>s(a).offer=l)},null,8,["value"])]),_:1}),t(u,{span:24},{default:o(()=>[Oe,t(j,{placeholder:"\u0413\u043B\u0430\u0437\u043E\u0432-\u041F\u0435\u0440\u043C\u044C 300\u043A\u043C",size:"large",value:s(a).tripRoute,"onUpdate:value":e[10]||(e[10]=l=>s(a).tripRoute=l)},null,8,["value"])]),_:1}),t(u,{span:24,style:{display:"flex","flex-direction":"column"}},{default:o(()=>[De,t(s(se),{theme:"snow",ref_key:"quill",ref:U,content:f.value,"onUpdate:content":e[11]||(e[11]=l=>f.value=l),contentType:"html",toolbar:[["bold","italic","underline"],[{list:"ordered"},{list:"bullet"}],[{color:["#000000","#ff6600","#3daff5"]}],[{align:[]}]]},null,8,["content"])]),_:1}),t(u,{span:24,class:"d-flex justify-center"},{default:o(()=>[t(r,{class:"mt-16",type:"primary",size:"large","html-type":"submit"},{default:o(()=>[Je]),_:1})]),_:1})]),_:1})],40,ie),t(P,{visible:s(v),"onUpdate:visible":e[12]||(e[12]=l=>q(v)?v.value=l:v=l),footer:null},{default:o(()=>[t(oe,{onAddImage:G})]),_:1},8,["visible"]),t(P,{visible:w.value,"onUpdate:visible":e[13]||(e[13]=l=>w.value=l),footer:null},{default:o(()=>[Le,d("div",Re,[t(r,{class:"mt-16",type:"primary",size:"large",onClick:E},{default:o(()=>[Ye]),_:1})])]),_:1},8,["visible"])]),_:1})]),_:1})])}}};export{$e as default};
